---
title: "RNAseq data summary"
author: "Cait McDonald"
date: "Last Updated: `r Sys.Date()`"
output:
  html_document:
    df_print: paged
    toc: true
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE)
start_time <- Sys.time()
```


```{r, message=FALSE}
library(tidyverse)
library(here)
# dir.create("outputs/001", recursive = TRUE, showWarnings = FALSE)
# dir.create("intermediates/001", recursive = TRUE, showWarnings = FALSE)
```

## Overview
We have 39 RNAseq libraries from the following samples (start a summit session and use opt+cmd+return to send to terminal):
```{bash, eval=F} 
ls /scratch/summit/camcd@colostate.edu/felv_rnaseq/data/
```

Samples are named such as: `4438_S1_L002_R1_001.fastq.gz` in the `raw` directory. L002 and 001 are common to all files, and I assume indicate sequencing run info. I will shorten all filenames in `data` like so:

```{bash, eval=F}
for fname in *.fastq.gz ; do mv "$fname" "$(echo "$fname" | sed -r 's/L002_//')" ; done
for fname in *.fastq.gz ; do mv "$fname" "$(echo "$fname" | sed -r 's/_001//')" ; done
```

## What I want to do
I'd like to start using Snakemake, as recommended by Eric Anderson. It seems like a steepish learning curve???

Regardless, I want to:

1. run fastqc
1. run multiqc
1. run trimgalore (or trimmomatic?)
1. re-run fastqc on trimmed libraries
1. re-run multiqc on trimmed libraries

I have previously generated a shell script that does something to this effect:

```{bash, eval=F}
fastqc *.fastq.gz -o ./fastqc_raw -t 24 >& fastqc_raw.log #fastqc
multiqc ./fastqc_raw -o ./multiqc_raw #multiqc
parallel trim_galore --phred33 --length 36 -q 5 --stringency 1 -e 0.1 -o ./trim_galore_out/ {=s/_R1/_R2/=} ::: *_R1.fastq.gz
fastqc *.fastq.gz -o ./fastqc_trimmed -t 24 >& fastqc_trimmed.log #fastqc
multiqc ./fastqc_trimmed -o ./multiqc_trimmed #multiqc
```

I'm trying to turn that into a smk script...see `qc.smk`. One annoying thing is that .smk scripts are much nicer to write in Atom than Rmd. So not totally sure how I'll integrate everything? Also not sure if the .smk will work yet? And also not sure about how to integrate Snakemake with SLURM...

